<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>学者索引 - Sinologists</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="汉学家（Sinologists）索引与搜索，点击查看各人物维基页面的本地副本。">
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 min-h-screen">
  <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="text-xl font-bold text-purple-700">汉学研究</a>
      <div class="flex items-center gap-3">
        <a href="index.html" class="text-gray-700 hover:text-purple-600">返回首页</a>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-4 py-8">
    <header class="mb-6">
      <h1 class="text-3xl font-bold text-purple-800">学者索引</h1>
      <p class="text-gray-600 mt-1">数据来源：维基百科 <a class="text-purple-700 underline" href="https://en.wikipedia.org/wiki/List_of_sinologists" target="_blank" rel="noopener">List of sinologists</a></p>
    </header>

    <div class="bg-white rounded-xl shadow p-4 mb-4 flex flex-col sm:flex-row gap-3 items-stretch sm:items-center">
      <input id="q" type="search" placeholder="搜索姓名（支持片段）" class="flex-1 border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-300" autofocus>
      <div id="count" class="text-gray-600"></div>
    </div>

    <ul id="list" class="grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"></ul>

    <p class="text-sm text-gray-500 mt-6">许可与归属见 <a class="underline" href="attribution.html">Attribution</a></p>
  </main>

  <script>
    function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
    function highlight(text,q){if(!q) return text; const re=new RegExp(escapeRegExp(q),'ig'); return text.replace(re,m=>`<mark class="bg-yellow-200">${m}</mark>`)}
    function debounce(fn,delay){let t; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),delay)}}

    async function main(){
      const res = await fetch('manifest.json');
      const data = await res.json();
      const items = data.map(x=>({ name:x.name, file:(x.file||'').split('/').pop(), url:'people/'+(x.file||'').split('/').pop() }))
                        .filter(x=>x.name && x.url);

      const list = document.getElementById('list');
      const q = document.getElementById('q');
      const count = document.getElementById('count');

      function render(filter=''){
        const t = filter.trim().toLowerCase();
        const filtered = t ? items.filter(i=>i.name.toLowerCase().includes(t)) : items;
        count.textContent = `共 ${filtered.length} 条`;
        const frag = document.createDocumentFragment();
        filtered.forEach(i=>{
          const li=document.createElement('li');
          const a=document.createElement('a');
          a.href=i.url; a.target='_blank'; a.rel='noopener';
          a.className='block w-full border rounded-lg bg-white hover:shadow px-4 py-3';
          a.innerHTML = highlight(i.name, t);
          li.appendChild(a); frag.appendChild(li);
        });
        list.innerHTML=''; list.appendChild(frag);
      }

      q.addEventListener('input', debounce(()=>render(q.value), 150));
      render('');
    }
    main().catch(console.error);
  </script>
</body>
</html>
